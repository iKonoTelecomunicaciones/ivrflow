components:
  schemas:
    # Generic schemas
    BaseResponseDetailMessage:
      type: object
      properties:
        detail:
          type: object
          properties:
            message:
              type: string
    BaseResponseDetailMessageData:
      type: object
      properties:
        detail:
          type: object
          properties:
            message:
              type: string
            data:
              type: object
              additionalProperties: true
    # End of generic schemas

    GetEmailServersOk:
      type: object
      properties:
        email_servers:
          type: array
      example:
        email_servers:
          - example_email_server_1
          - example_email_server_2
          - example_email_server_3

    GetMiddlewaresOk:
      type: object
      properties:
        middlewares:
          type: array
      example:
        middlewares:
          - example_middleware_1
          - example_middleware_2
          - example_middleware_3

    CreateUpdateFlowOk:
      type: object
      properties:
        detail:
          type: object
      example:
          detail:
            message: Flow created successfully.
            data:
              flow_id: 1

    BodyNotJson:
      type: object
      properties:
        detail:
          type: object
      example:
        detail:
          message: Request body is not JSON.

    FlowIsRequired:
      type: object
      properties:
        detail:
          type: object
      example:
        detail:
          message: Parameter flow is required.

    GetFlowOk:
      type: object
      properties:
        id:
          type: integer
        flow_vars:
          type: object
          additionalProperties: true

    GetAllFlowsOk:
      type: object
      properties:
        flows:
          type: object
          additionalProperties:
            type: object
            properties:
              id:
                type: integer
              flow_vars:
                type: object
                additionalProperties: true

    GetFlowByIDNotFound:
      type: object
      properties:
        detail:
          type: object
      example:
        detail:
          message: Flow with ID 1 not found.

    GetFlowByNameNotFound:
      type: object
      properties:
        detail:
          type: object
      example:
        detail:
          message: Flow with name example_flow not found.

    FlowNameIsRequired:
      type: object
      properties:
        detail:
          type: object
      example:
        detail:
          message: Parameter name is required.

    FlowNameAlreadyExists:
      type: object
      properties:
        detail:
          type: object
      example:
        detail:
          message: Flow with name example_flow already exists.
    CheckTemplateOk:
      type: object
      properties:
        rendered:
          type: string
      example:
        rendered: "Hello world!"
    InvalidVariablesFormat:
      allOf:
        - $ref: "#/components/schemas/BaseResponseDetailMessage"
      example:
        detail:
          message: The format of the variables is not valid
    TemplateRequired:
      allOf:
        - $ref: "#/components/schemas/BaseResponseDetailMessage"
      example:
        detail:
          message: Template is required

    GetModuleOk:
      type: object
      properties:
        id:
          type: integer
        flow_id:
          type: integer
        name:
          type: string
        nodes:
          type: array
          items:
            type: object
            additionalProperties: true
        position:
          type: object

    GetAllModulesOk:
      type: object
      properties:
        modules:
          type: object
          additionalProperties:
            type: object
            properties:
              id:
                type: integer
              flow_id:
                type: integer
              nodes:
                type: array
                items:
                  type: object
                  additionalProperties: true
              position:
                type: object
                additionalProperties: true
    CreateUpdateModuleOk:
      type: object
      properties:
        detail:
          type: object
          properties:
            message:
              type: string
            data:
              type: object
              properties:
                module_id:
                  type: integer
    GetNodeOk:
      type: object
      properties:
        module_name:
          type: string
        node:
          type: object
          additionalProperties: true
      example:
        module_name: "Main"
        node:
          id: "start"
          type: "get_full_variable"
          variables:
            customer_phone: "57${CALLERID(num)}"
    GetModuleBackupsOk:
      type: object
      properties:
        count:
          type: integer
        backups:
          type: array
          items:
            type: object
            additionalProperties: true
      example:
        count: 1
        backups:
          - id: 1
            flow_id: 1
            name: "Main"
            nodes:
              - id: 1
                flow_id: 1
                name: "Main"
            position:
              x: 632.8705383300783
              y: 357.11742401123036
              scale: 0.4092324994498387
            created_at: "2021-01-01T00:00:00Z"
    GetListNodesOk:
      type: object
      properties:
        nodes:
          type: array
      example:
        nodes:
          - module_id: 1
            id: start
            type: message
            name: start
            o_connection: message_1
          - module_id: 1
            id: message_1
            type: message
            name: message_1
            o_connection: message_2

    # Error schemas
    ErrorReadingData:
      allOf:
        - $ref: "#/components/schemas/BaseResponseDetailMessage"
      example:
        detail:
          message: "Error reading data: 'error_message'"

    ErrorSyntaxTemplate:
      allOf:
        - $ref: "#/components/schemas/BaseResponseDetailMessage"
      example:
        detail:
          message: "Syntax error in template: 'error_message'"


  responses:
    # Generic responses
    InternalServerError:
      description: Server error.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/BaseResponseDetailMessage"
          example:
            detail:
              message: "error_message"
    # End of generic responses

    GetEmailServersSuccess:
      description: Get email servers success.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/GetEmailServersOk"

    GetMiddlewaresSuccess:
      description: Get middlewares success.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/GetMiddlewaresOk"

    UpdateFlowSuccess:
      description: Update flow success.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/CreateUpdateFlowOk"
          example:
            detail:
              message: Flow updated successfully.
              data:
                flow_id: 1
    CreateFlowSuccess:
      description: Create flow success.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/CreateUpdateFlowOk"
          example:
            detail:
              message: Flow created successfully.
              data:
                flow_id: 1

    CreateUpdateFlowBadRequest:
      description: Create or update flow bad request.
      content:
        application/json:
          schema:
            oneOf:
              - $ref: "#/components/schemas/BodyNotJson"
              - $ref: "#/components/schemas/FlowIsRequired"
              - $ref: "#/components/schemas/FlowNameIsRequired"
              - $ref: "#/components/schemas/GetFlowByIDNotFound"
              - $ref: "#/components/schemas/FlowNameAlreadyExists"
          examples:
            BodyNotJson:
              value:
                detail:
                  message: Request body is not JSON.
            FlowIsRequired:
              value:
                detail:
                  message: Parameter flow is required.
            FlowNameIsRequired:
              value:
                detail:
                  message: Parameter name is required.
            GetFlowByIDNotFound:
              value:
                detail:
                  message: Flow with ID 1 not found.
            FlowNameAlreadyExists:
              value:
                detail:
                  message: Flow with name example_flow already exists.

    GetFlowSuccess:
      description: Get flow success.
      content:
        application/json:
          schema:
            oneOf:
              - $ref: "#/components/schemas/GetFlowOk"
              - $ref: "#/components/schemas/GetAllFlowsOk"
          examples:
            GetFlow:
              value:
                id: 1
                flow_vars:
                  variable_1: value_1
                  variable_2: value_2
            GetAllFlows:
              value:
                flows:
                  Main:
                    id: 1
                    flow_vars:
                      variable_1: value_1
                      variable_2: value_2
                  Second:
                    id: 2
                    flow_vars:
                      variable_1: value_1
                      variable_2: value_2

    GetFlowNotFound:
      description: Get flow not found.
      content:
        application/json:
          schema:
            oneOf:
              - $ref: "#/components/schemas/GetFlowByIDNotFound"
              - $ref: "#/components/schemas/GetFlowByNameNotFound"
          examples:
            GetFlowByIDNotFound:
              value:
                detail:
                  message: Flow with ID 1 not found.
            GetFlowByNameNotFound:
              value:
                detail:
                  message: Flow with name example_flow not found.
    CheckTemplateSuccess:
      description: Check template success.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/CheckTemplateOk"

    CheckTemplateUnprocessable:
      description: Check template unprocessable.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorSyntaxTemplate"

    CheckTemplateBadRequest:
      description: Check template bad request.
      content:
        application/json:
          schema:
            oneOf:
              - $ref: "#/components/schemas/ErrorReadingData"
              - $ref: "#/components/schemas/InvalidVariablesFormat"
              - $ref: "#/components/schemas/TemplateRequired"
          examples:
            ErrorReadingData:
              value:
                detail:
                  message: "Error reading data: 'error_message'"
            InvalidVariablesFormat:
              value:
                detail:
                  message: The format of the variables is not valid
            TemplateRequired:
              value:
                detail:
                  message: Template is required

    GetModuleSuccess:
      description: Get Module success.
      content:
        application/json:
          schema:
            oneOf:
              - $ref: "#/components/schemas/GetModuleOk"
              - $ref: "#/components/schemas/GetAllModulesOk"
          examples:
            GetModule:
              value:
                id: 1
                flow_id: 1
                name: "Main"
                nodes:
                  - id: start
                    type: get_full_variable
                    variables:
                      customer_phone: "57${CALLERID(num)}"
                    o_connection: goto_ivr
                position:
                  x: 632.8705383300783
                  y: 357.11742401123036
                  scale: 0.4092324994498387
            GetAllModules:
              value:
                modules:
                  Main:
                    id: 1
                    flow_id: 1
                    nodes:
                        - id: start
                          type: get_full_variable
                          variables:
                            customer_phone: "57${CALLERID(num)}"
                          o_connection: goto_ivr
                    position:
                      x: 632.8705383300783
                      y: 357.11742401123036
                      scale: 0.4092324994498387
                  Second:
                    id: 2
                    flow_id: 1
                    nodes:
                      nodes:
                        - id: goto_ivr
                          type: goto_on_exit
                          context: "Menu-Principal"
                          extension: "s-Menu-Principal"
                          priority: "Begin"
                    position:
                      x: 632.8705383300783
                      y: 357.11742401123036
                      scale: 0.4092324994498387
    GetModuleNotFound:
      description: Get module not found.
      content:
        application/json:
          schema:
            oneOf:
              - $ref: "#/components/schemas/BaseResponseDetailMessage"
          examples:
            FlowNotFound:
              value:
                detail:
                  message: Flow with ID 1 not found in the database
            GetModuleByIDNotFound:
              value:
                detail:
                  message: Module with ID 1 not found
            GetModuleByNameNotFound:
              value:
                detail:
                  message: Module with name 'module_name' not found
    GetModuleBadRequest:
      description: Get module bad request.
      content:
        application/json:
          schema:
            oneOf:
              - $ref: "#/components/schemas/BaseResponseDetailMessage"
          example:
            detail:
              message: Invalid or missing flow ID
    CreateModuleNotFound:
      description: Post module not found.
      content:
        application/json:
          schema:
            oneOf:
              - $ref: "#/components/schemas/BaseResponseDetailMessage"
          example:
            detail:
              message: Flow with ID 1 not found in the database
    CreateModuleBadRequest:
      description: Post module bad request.
      content:
        application/json:
          schema:
            oneOf:
              - $ref: "#/components/schemas/BaseResponseDetailMessage"
          examples:
            BodyNotJson:
              value:
                detail:
                  message: Request body is not JSON.
            InvalidFlowID:
              value:
                detail:
                  message: Invalid or missing flow ID
            ParameterRequired:
              value:
                detail:
                  message: Parameter 'name' is required.
            ModuleNameAlreadyExists:
              value:
                detail:
                  message: Module with name 'module_name' already exists in flow_id 1
    CreateModuleSuccess:
      description: Post module success.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/CreateUpdateModuleOk"
          example:
            detail:
              message: Module created successfully
              data:
                module_id: 1
    UpdateModuleNotFound:
      description: Update module not found.
      content:
        application/json:
          schema:
            oneOf:
              - $ref: "#/components/schemas/BaseResponseDetailMessage"
          examples:
            FlowNotFound:
              value:
                detail:
                  message: Flow with ID 1 not found in the database
            ModuleNotFound:
              value:
                detail:
                  message: Module with ID '1' not found in flow_id '1'
    UpdateModuleConflict:
      description: Update module conflict.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/BaseResponseDetailMessageData"
          examples:
            NodeAlreadyExists:
              value:
                detail:
                  message: Node with ID 'id' already exists
                  data:
                    module_name: module_name
            NodeIsRepeated:
              value:
                detail:
                  message: Node with ID 'id' is repeated
                  data:
                    module_name: ''
    UpdateModuleBadRequest:
      description: Update module bad request.
      content:
        application/json:
          schema:
            oneOf:
              - $ref: "#/components/schemas/BaseResponseDetailMessage"
          examples:
            BodyNotJson:
              value:
                detail:
                  message: Request body is not JSON.
            InvalidType:
              value:
                detail:
                  message: Flow ID and module ID must be valid integers
            EmptyBody:
              value:
                detail:
                  message: At least one of the parameters name, nodes or position is required
            ModuleNameAlreadyExists:
              value:
                detail:
                  message: Module with name 'module_name' already exists in flow_id 1
    UpdateModuleSuccess:
      description: Update module success.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/CreateUpdateModuleOk"
          example:
            detail:
              message: Module updated successfully
              data:
                module_id: 1
    CreateModuleConflict:
      description: Create module conflict.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/BaseResponseDetailMessageData"
          examples:
            NodeAlreadyExists:
              value:
                detail:
                  message: Node with ID 'id' already exists
                  data:
                    module_name: module_name
            NodeIsRepeated:
              value:
                detail:
                  message: Node with ID 'id' is repeated
                  data:
                    module_name: ''
    DeleteModuleNotFound:
      description: Delete module not found.
      content:
        application/json:
          schema:
            oneOf:
              - $ref: "#/components/schemas/BaseResponseDetailMessage"
          examples:
            FlowNotFound:
              value:
                detail:
                  message: Flow with ID 1 not found in the database
            ModuleNotFound:
              value:
                detail:
                  message: Module with ID 1 not found in flow_id 1
    DeleteModuleBadRequest:
      description: Delete module bad request.
      content:
        application/json:
          schema:
            oneOf:
              - $ref: "#/components/schemas/BaseResponseDetailMessage"
          example:
            detail:
              message: Flow ID and module ID must be valid integers
    DeleteModuleSuccess:
      description: Delete module success.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/BaseResponseDetailMessage"
          example:
            detail:
              message: Module deleted successfully
    GetListModulesSuccess:
      description: Get list modules success.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/GetAllModulesOk"
          example:
            modules:
              - id: 1
                name: Main
              - id: 2
                name: Second
    GetListModulesBadRequest:
      description: Get list modules bad request.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/BaseResponseDetailMessage"
          example:
            detail:
              message: Invalid or missing flow ID
    GetListModulesNotFound:
      description: Get list modules not found.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/BaseResponseDetailMessage"
          example:
            detail:
              message: Flow with ID 1 not found in the database
    GetNodeSuccess:
      description: Get node success.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/GetNodeOk"
    GetNodeBadRequest:
      description: Get node bad request.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/BaseResponseDetailMessage"
          example:
            detail:
              message: Invalid or missing flow ID
    GetNodeNotFound:
      description: Get node not found.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/BaseResponseDetailMessage"
          example:
            detail:
              message: Node with ID '1' not found in the database
    ModuleBackupsSuccess:
      description: Get module backups success.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/GetModuleBackupsOk"
    ModuleBackupsNotFound:
      description: Get module backups not found.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/BaseResponseDetailMessage"

    GetListNodesSuccess:
      description: Get list nodes success.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/GetListNodesOk"
    GetListNodesNotFound:
      description: Get list nodes not found.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/BaseResponseDetailMessage"
          example:
            detail:
              message: Flow with ID 1 not found in the database
